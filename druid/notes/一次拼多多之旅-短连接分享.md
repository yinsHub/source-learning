> 最近收到挺多朋友的拼多多**助力**需求，以前有时候会“婉拒”（手动狗头），有时候点一下。今天可能心血来潮(如有打扰，算你“幸运” 😏😏)，就发现还是“挺好玩的”。以一个技术渣的心态去看待这件事，那么......

## 短链接

<img src="https://cdn.superyins.cn/image-20220515141254583.png" alt="image-20220515141254583" style="zoom:50%;" />

> 正如上图而言，我们给到/收到朋友助力的形式之一，就有这样一个一个的短链接。其实除了拼多多的这种推广链接是短链接，日常生活还有其他很多的推广分享也是基于**短链接**

- http://gk.link/a/11oy2 （极客时间）
- https://m.tb.cn/h.fIT9G3U（淘宝）
- https://3.cn (京东)内部使用的，没办法给可用的链接
- https://t.cn (微博) 这个应该看到过很多，尤其是短信收到的
- https://v.douyin.com/XhFhVR （抖音）
- https://dwz.cn (百度) **拼多多用的就是这个**,要钱的
- https://dwz.cn/zrYnCad1

- ......

短链接有什么好处呢？

- 短
- 短
- 短

重要的事情需要说3次，因为这是它最直白的地方。短会显得比较干净并且也易于传播（我乱说的）

可能你看上面的链接还不够短，其实也可以这样。（省略了约定俗成的协议）

- gk.link/a/11oy2
- m.tb.cn/h.fIT9G3U
- 3.cn
- t.cn

那么这短的链接，是如何生成与工作的呢 ?

### 短链接的生成

> 可以看到，短链接都是由**域名**+**字母+数字**（固定长度）

短 URL 采用Base64编码

**简单来说就是：字母`A-Z`、`a-z`、数字`0-9`、符号`+/`,这样共有64个字符,就是Base64编码**（/ +很少被使用，很多用-与_代替）

如果短 URL 长度是 7 个字符的话，排列组合，大约可以编码 4 万亿个短 URL。

64^7≈4万亿

如果短 URL 长度是 6 个字符的话，排列组合，大约可以编码 680 亿个短 URL。

64^6≈680亿

那https://dwz.cn/zrYnCad为何是8位呢，因为它是百度的啊，百度对外提供的收费项目，那它的预估量肯定是超过4万亿的，8位的话，大概可以组合250万亿的短链接,百度的价格表

![image-20220515191951375](https://cdn.superyins.cn/image-20220515191951375.png)

用几位字符做短链接实质上是非常重要的，因为越多，**负担**就会越大，当然也可以是甜蜜的负担

> 短链接的生成

我们知道，短链接的使用场景是把全链接转换为短链接

比如淘宝的分享链接：

```tex
原地址：
https://detail.tmall.com/item.htm?id=671080496877&price=4699-5998&sourceType=item&sourceType=item&suid=086a21c4-d5b1-4438-92ef-68272a10a623&ut_sk=1.XVwR56JqJD8DAJWjDtz7lXsw_21646297_1652605882737.Copy.ShareGlobalNavigation_1&un=b5ab6864ffa2c0d6132b0f6991806569&share_crt_v=1&un_site=0&spm=a2159r.13376460.0.0&sp_abtk=common_1_commonInfo&tbSocialPopKey=shareItem&sp_tk=dXladDI5dEJTdmo=&cpp=1&shareurl=true&short_name=h.fIT9G3U&bxsign=scdY46xV_GRinmpopnQGV5Kn7xTilctLmDsMmp0i4N4vD1QIwBV6mI5C-WXenjRqTFhTQzlLRBxlLxWJYf5mx3kRJefkbUuujMh4ZrybWCopaW0TE6iL72YA7DDgq-f8C6n&app=chrome
短链接：
https://m.tb.cn/h.fIT9G3U
```

短链接的生成方式很多种，这里简单说一种就是预生成250万亿个短链接存储好

> 当全链接转短链接的需求来了，直接从短链接池里面取出一个没被使用的

然后取出的这个短链接与原链接做一个1:1的绑定。

### 短链接的使用

> 我们访问短链接的时候，都会最终转到全链接
>
> 可以试试哦

所以，短链接是怎么转到全链接的呢 ？

前面我们说过，全链接转短链接的时候会有个一对一的绑定关系，所以我们访问短链接的时候，有2个步骤

- 短链接转全链接
- （重定向）转接访问到全链接



**短链接转全链接？**

毕竟短链接可是有680亿(长度6)、4万亿(7)、250万亿(8)，这怎么找呀？

这就是百度一年可以收50万的技术啦.
简单来说的话，就是存储会用到Hbase+HDFS，在用Redis做热点缓存。

**转接访问到全链接**

转接这个事情，用技术的话来说就是重定向，重定向也分2种，301,302

**301 表示永久重定向**，即浏览器一旦访问过该短 URL，就将重定向的原始长 URL 缓存在本地，此后不再请求短 URL 生成器，直接根据缓存在浏览器（HTTP 客户端）的长 URL 路径进行访问。

**302 表示临时重定向**，每次访问短 URL 都需要访问短 URL 生成器。

只能说各有优劣吧。

**关于短连连接这个事情**
其他没有提到的点，可能从QPS,数据的存储，业务的部署，还有挺多可以值得我们学习挖掘的点
## 永远的0.01

这里有个算法：**分裂循环**，好痛恨这个算法。



哈哈哈，没想到吧，一个小小的短链接都有这么多道道。
